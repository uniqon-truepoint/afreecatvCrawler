# afreecatvCrawler
아프리카tv채팅 데이터 크롤러(트루포인트 용역)


## 아프리카 크롤러 작동 방식

**1. 2분 마다 타겟 크리에이터의 방송 상태(실시간 방송 중인지, 방송 종료상태 인지)를 체크**

**2. 1번 실행 시 새로 방송을 킨 크리에이터의 실시간 방송의 채팅 데이터만 수집 대상에 추가**

- 수집 대상 없을시 크롤링 실행은 하지 않음

**3. 생방송을 킨 크리에이터 방송에 입장하여 채팅 데이터를 수집**

- 셀레니움이 0.5초 마다 올라오는 채팅을 확인하여 저장 대상으로 판단.
- 셀레니움이 파악하는 신규 채팅보다 시청자들의 채팅 생성량이 많을 시 새로고침.

**4. 방송 종료시 수집된 채팅 데이터를 DB에 저장**

- 크리에이터가 19세 방송 설정시 그전까지의 채팅을 데이터베이스에 저장 후 19세 방송종료까지 채팅 데이터 미수집
- 크리에이터가 비밀번호 방송 설정시 그전까지 채팅을 데이터베이스에 저장 후 비밀 방송종료까지 채팅 데이터 미수집

**5. 해당 작업을 무한 실시**

---

## 작동방법

**1. 가상환경 실행( 가상환경 이름 .venv 으로 할 것)**

```bash
source .venv/bin/activate # Mac
source .venv/Scripts/activate #윈도우
```

**2. requirement 참고, 필요패키지 다운**
개발환경이 윈도우일 경우 pywin32 패키지 추가 설치 필요

**3. scrapyd 서버 실행(새로운 터미널 생성 - cd crawler 이동)**

```bash
scrapyd
```

**4. scrapyd 서버에 크롤러 프로젝트 디플로이(새로운 터미널 생성 - cd crawler 이동)**

```bash
scrapyd-deploy --project=crawler
```

> _crawler 프로젝트 코드 변경시 eggs/crawler 폴더의 버전명.egg 파일 삭제후 다시 위 명령어를 실행하여 새버전을 사용_

**5. 스크립트 실행**

```bash
python run.py
```

---

## 주의사항

1. .venv/lib 내부, orator/orm/model.py의 \_\_timestamps\_\_ 값 False로 변경 필요.
2. crawler/drivers 폴더의 chromedirver는 맥용 프로그램을 설치함. 맥의 경우 맥용 크롬드라이버를 위치시켜야함
3. 멀티프로세스 기본 8로 설정하였음, 본인의 CPU 코어에 맞게 숫자변경 필요.

- cralwer/run.py 하단 **Pool(processes=8)** 의 processes 인자 변경할 것!

4. 크롤러 특성상 타겟 사이트의 UI 변경 시 로직 변경이 필수적
5. kmotiv 아프리카 성인 인증 세션 만료 시 성인방송 입장 불가함
